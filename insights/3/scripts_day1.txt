Insights 3 - 2019 DAY 1:

===================================================================================================================================

SELECT s.id as submission_id, s.participation_id, MAX(res.score) score, s.timestamp, s.task_id, (select name from tasks where id = s.task_id)
FROM submissions s 
INNER JOIN (SELECT p.id AS participation_id FROM participations p INNER JOIN users u ON p.user_id = u.id WHERE u.medals = 1 and u.id = 106) p
ON s.participation_id = p.participation_id
INNER JOIN submission_results res
ON s.id = res.submission_id
WHERE s.timestamp >= (SELECT start FROM contests WHERE id = 2)
AND s.timestamp <= (SELECT stop FROM contests WHERE id = 2)
AND s.official = TRUE
GROUP BY s.id
ORDER BY s.timestamp;

WITH subs AS (
SELECT s.id as submission_id, s.participation_id, MAX(res.score) score, s.timestamp, s.task_id, (select name from tasks where id = s.task_id)
FROM submissions s 
INNER JOIN (SELECT p.id AS participation_id FROM participations p INNER JOIN users u ON p.user_id = u.id WHERE u.medals = 1 and u.id = 106) p
ON s.participation_id = p.participation_id
INNER JOIN submission_results res
ON s.id = res.submission_id
WHERE s.timestamp >= (SELECT start FROM contests WHERE id = 2)
AND s.timestamp <= (SELECT stop FROM contests WHERE id = 2)
AND s.official = TRUE
GROUP BY s.id
ORDER BY s.timestamp
)
SELECT 
submission_id, 
score, 
timestamp, 
name,
timestamp - LAG(timestamp,1) OVER (
PARTITION BY participation_id
ORDER BY timestamp
) time_diff_with_prev_submission
FROM subs;






